# Procedures 
Procedures are stored queries; SQL allows us to store queries and call them later on when needed. You can think of procedures as functions.


## Create Procedure 

To create a procedure, use the `CREATE PROCEDURE` command as follows.

```sql
CREATE PROCEDURE procedure_name()
BEGIN
    -- Your query
END;

```
**Example**
```sql
CREATE PROCEDURE GetAllStudents()
BEGIN
    SELECT * FROM Students;
END;
```

This command should create a procedure called `GetAllStudents()`. However, you might run into a syntax error generated by the `;` added after each statement.
MySQL treats `;` as the end of a command. Inside a procedure, we use many `;` characters, so MySQL gets confused and thinks the procedure ends early. 
To avoid this, we temporarily change the delimiter to something else, such as `$$`, so MySQL knows where the procedure actually ends.

```sql
DELIMITER $$

CREATE PROCEDURE GetAllStudents()
BEGIN
    SELECT * FROM Students;
END $$

DELIMITER ;
```
Now, MySQL has a temporary delimiter of `$$`. Once the procedure is created, we can get back to our delimiter of `;`.

> [!NOTE]
> You can use any delimiter you want, such as `//`, `@@`, or `###`. `$$` is just a common convention.


> [!IMPORTANT]
> The delimiter is only used by the **MySQL client** to detect the end of the procedure; it is not stored as part of the procedure itself.

## Procedure with Arguments
To make procedures more flexible and reusable, we can pass arguments to them. This is done by defining parameters inside the procedure’s parentheses, 
allowing the procedure to work with different input values each time it is called.

MySQL supports three types of parameters:

- **IN** – input value passed into the procedure  
- **OUT** – value returned from the procedure  
- **INOUT** – value passed in, modified, and returned  

To create a procedure with arguments, only add the parameters with their correct type as follows:
```sql
CREATE PROCEDURE procedure_name(IN parameter_name datatype)
BEGIN
    -- Your query
END;
```

**Example**
Create a procedure to retrieve a student by their id.
```sql
CREATE PROCEDURE GetStudentByID(IN student_id INT)
BEGIN
    SELECT * FROM Students
    WHERE id = student_id;
END;
```
Just like before, this will cause an error unless we change the delimiter. So we write it as follows:
```sql
DELIMITER $$

CREATE PROCEDURE GetStudentByID(IN student_id INT)
BEGIN
    SELECT * FROM Students
    WHERE id = student_id;
END $$

DELIMITER ;
```

## Call Procedures

To call a procedure, use the `CALL` command as follows:


**Example**: without parameters

```sql
CALL GetAllStudents();
```


**Output**
| id | name | age | gpa |
|----|------|-----|-----|
| 1  | Rana |  21 | 3.90 |
| 2  | Nouf |  20 | 2.75 |
| 4  | Maha |  20 | 3.89 |


**Example**: with parameters

```sql
CALL GetStudentByID(1);
```

**Output**

| id | name | age | gpa |
|----|------|-----|-----|
| 1  | Rana |  21 | 3.90 |


## Practice

1. Create a procedure named `AddStudent` with the following parameters:
   - `student_id` (INT)
   - `student_name` (VARCHAR)
   - `student_age` (INT)
   - `student_gpa` (DECIMAL)
2. Inside the procedure, insert a new row into the `Students` table.
3. Call the procedure to add the following student:

   | id | name | age | gpa |
   |----|------|-----|-----|
   | 5  | Sara | 22  | 3.40 |



> [!NOTE]
> If the `id` column is auto-incremented, then there will be no need to pass the `student_id` parameter.
